import telegram
from telegram.ext import Application, CommandHandler, MessageHandler, filters
from datetime import datetime, timedelta

# --- ‚öôÔ∏è –û—Å–Ω–æ–≤–∞ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ ‚öôÔ∏è ---

TELEGRAM_BOT_TOKEN = "8139998528:AAFka51sXJ6j2uSGCaFYO6obYzD2n6YUQ2o"
START_DATE_STR = "06-12-2025"  # –ö–æ–≥–¥–∞ –±—Ä–æ—Å–∏–ª–∏ –∫—É—Ä–∏—Ç—å?
CIGS_PER_PACK = 20  # –°–∫–æ–ª—å–∫–æ —Å–∏–≥–∞—Ä–µ—Ç –≤ –ø–∞—á–∫–µ?
CIGS_PER_DAY = 7  # –ö–æ–ª-–≤–æ —Å–∏–≥–∞—Ä–µ—Ç –≤ –¥–µ–Ω—å
PACK_COST = 1100  # –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–∞—á–∫–∏
CURRENCY = "KZT"  # –í–∞–ª—é—Ç–∞

# -----------------------------------------------------
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –¥–∞—Ç—ã –≤ –æ–±—ä–µ–∫—Ç datetime
START_DATE = datetime.strptime(START_DATE_STR, "%d-%m-%Y")

#  –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –ø—Ä–æ—à–µ–¥—à–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ (–≤ —á–∞—Å–∞—Ö)
ACHIEVEMENTS = [
    (2, "üéâ **–ü—Ä–æ—à–ª–æ 2 —á–∞—Å–∞!** –£—Ä–æ–≤–µ–Ω—å –Ω–∏–∫–æ—Ç–∏–Ω–∞ –≤ –∫—Ä–æ–≤–∏ —É–ø–∞–ª –≤–¥–≤–æ–µ. –¢–µ–ª–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—á–∏—â–∞—Ç—å—Å—è."),
    (8,
     "üí™ **–ü—Ä–æ—à–ª–æ 8 —á–∞—Å–æ–≤!** –£—Ä–æ–≤–µ–Ω—å —É–≥–∞—Ä–Ω–æ–≥–æ –≥–∞–∑–∞ (CO) –≤ –∫—Ä–æ–≤–∏ —Å–Ω–∏–∑–∏–ª—Å—è –¥–æ –Ω–æ—Ä–º—ã. –ö—Ä–æ–≤—å —Å—Ç–∞–ª–∞ –ª—É—á—à–µ –Ω–∞—Å—ã—â–∞—Ç—å—Å—è –∫–∏—Å–ª–æ—Ä–æ–¥–æ–º."),
    (24, "üí® **–ü—Ä–æ—à–ª–æ 24 —á–∞—Å–∞!** –†–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–∞ –Ω–∞—á–∞–ª —Å–Ω–∏–∂–∞—Ç—å—Å—è."),
    (48,
     "üëÖ **–ü—Ä–æ—à–ª–æ 2 –¥–Ω—è!** –£–ª—É—á—à–∞–µ—Ç—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∫—É—Å –∏ –∑–∞–ø–∞—Ö. –ù–µ—Ä–≤–Ω—ã–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è."),
    (72, "üîã **–ü—Ä–æ—à–ª–æ 3 –¥–Ω—è!** –î—ã—Ö–∞–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–µ–≥—á–µ. –£—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è."),
    (336, "üå± **–ü—Ä–æ—à–ª–æ 2 –Ω–µ–¥–µ–ª–∏!** –£–ª—É—á—à–∞–µ—Ç—Å—è –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ. –•–æ–¥–∏—Ç—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–µ–≥—á–µ. –£–ª—É—á—à–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –ª–µ–≥–∫–∏—Ö."),
    (1440, "ü•≥ **–ü—Ä–æ—à–µ–ª 2 –º–µ—Å—è—Ü!** –ö–∞—à–µ–ª—å –∏ –æ–¥—ã—à–∫–∞ —É–º–µ–Ω—å—à–∞—é—Ç—Å—è. –õ–µ–≥–æ—á–Ω–∞—è —Ç–∫–∞–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è."),
    (4320, "ü•≥ **–ü—Ä–æ—à–ª–æ 6 –º–µ—Å—è—Ü–µ–≤!** –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π."),
    (8760, "üèÜ **–ü—Ä–æ—à–µ–ª 1 –≥–æ–¥!** –†–∏—Å–∫ –∏—à–µ–º–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏ —Å–µ—Ä–¥—Ü–∞ —Å–Ω–∏–∑–∏–ª—Å—è –≤–¥–≤–æ–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∫—É—Ä–∏–ª—å—â–∏–∫–æ–º."),
]


# --- üìö –§–£–ù–ö–¶–ò–ò –†–ê–°–ß–ï–¢–ê (–õ–û–ì–ò–ö–ê) ---

def calculate_progress():
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è, —Å–∏–≥–∞—Ä–µ—Ç—ã –∏ –¥–µ–Ω—å–≥–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–∫–∞–∑–∞"""

    # 1. –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ (timedelta)
    now = datetime.now()
    time_delta = now - START_DATE

    total_seconds = int(time_delta.total_seconds())

    # –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –≤ –±—É–¥—É—â–µ–º
    if total_seconds < 0:
        return None, None, None, None, None

        # –ü–µ—Ä–µ–≤–æ–¥ —Å–µ–∫—É–Ω–¥ –≤ –¥–Ω–∏/—á–∞—Å—ã/–º–∏–Ω—É—Ç—ã
    days = time_delta.days
    # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Å –Ω–∞—á–∞–ª–∞
    total_hours = total_seconds // 3600
    minutes = (total_seconds % 3600) // 60

    # 2. –†–∞—Å—á–µ—Ç —Å–∏–≥–∞—Ä–µ—Ç –∏ –¥–µ–Ω–µ–≥

    # –°–∏–≥–∞—Ä–µ—Ç –≤ —á–∞—Å: CIGS_PER_DAY / 24
    cigs_saved = round(total_hours * (CIGS_PER_DAY / 24))

    # –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π —Å–∏–≥–∞—Ä–µ—Ç—ã: PACK_COST / CIGS_PER_PACK
    money_saved = round(cigs_saved * (PACK_COST / CIGS_PER_PACK), 2)

    return days, total_hours, minutes, cigs_saved, money_saved
